---
- name: Remove legacy sources.list
  ansible.builtin.file:
    path: /etc/apt/sources.list
    state: absent

- name: Configure Debian Sources (Deb822 format)
  ansible.builtin.copy:
    dest: /etc/apt/sources.list.d/debian.sources
    content: |
      Types: deb deb-src
      URIs: http://{{ debian_mirror }}/debian
      Suites: {{ debian_release }} {{ debian_release }}-updates
      Components: main contrib non-free non-free-firmware
      Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg

      Types: deb deb-src
      URIs: http://security.debian.org/debian-security
      Suites: {{ debian_release }}-security
      Components: main contrib non-free non-free-firmware
      Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg
  notify: Update Apt

- name: Force Update Apt
  ansible.builtin.apt:
    update_cache: yes
  changed_when: false

- name: Install Core Packages
  ansible.builtin.apt:
    name: "{{ core_packages }}"
    state: present
